@page "/pagestatemachinedynamic1"

@using Code420.SfBlazorPlus.CustomComponents.PageStateMachine.PageStateManager
@using Code420.SfBlazorPlus.Code.Enums
@using Code420.SfBlazorPlus.BaseComponents.ButtonBase
@using Code420.SfBlazorPlus.Pages.DynamicComponent1


<!--
    This is a sample SPA that demonstrates use of the PageStateManager with a state (Operating in this case)
    that deploys a component that progresses through multiple states through the use of Dynamic Components.

    The Loading and Error states below are simple buttons that move from Loading to Operating and Error to Loading.
    Nothing special about these except they would normall containg a Loading indicator (plan on using a spinner component
    here), or the appropriate handling out of an Error state (plan to use a standardized error dialog here).

    The meat of this demonstration is the Operating state which renders a child component using Dynamic Components.
-->

<PageStateManager   @ref=@pageStateManager 
                    PageState=PageState.Loading>

    <Loading>
        Loading State... (dynamic)
        <ButtonBase @ref=@loadingButton
                    IsPrimary=true
                    CssClass="loading-button"
                    OnClick=@OnLoadingButtonClick
                    Margin="0px 0px 0px 10px"
                    Padding="4px 8px"
                    >
            <ContentFragment>Move On</ContentFragment>
        </ButtonBase>
    </Loading>

    <Operating>
        <PageStateDynamicComponent  @ref=@dynamicComponent
                                    ChangePageState=@UpdatePageState
                                    PreviousPageState=PageState.Loading
                                    NextPageState=PageState.Error
                                    >
        </PageStateDynamicComponent>
    </Operating>

    <Error>
        Error Sate... (dynamic)
        <ButtonBase @ref=@errorButton
                    IsPrimary=true
                    CssClass="error-button"
                    OnClick=@OnErrorButtonClick
                    Margin="0px 0px 0px 10px"
                    Padding="4px 8px"
                    >
            <ContentFragment>Retry</ContentFragment>
        </ButtonBase>
    </Error>

</PageStateManager>

@code 
{
    
    //
    // Instance Variable
    //
    public PageStateManager pageStateManager;
    PageState currentPageState = PageState.Loading;     // No real use for this right now...defined just in case.

    private ButtonBase loadingButton;
    private ButtonBase operatingButton;
    private ButtonBase errorButton;
    private PageStateDynamicComponent dynamicComponent;



    // Events

    private void OnOperatingButtonClick() =>  pageStateManager.SetPageState(PageState.Error);

    private void OnErrorButtonClick() => pageStateManager.SetPageState(PageState.Loading);

    private void OnLoadingButtonClick() => pageStateManager.SetPageState(PageState.Operating);

    private void UpdatePageState(PageState pageState)
    {
        currentPageState = pageState;
        pageStateManager.SetPageState(pageState);
    }

}
